---
layout: post
title:  "C 语言中二维动态数组"
date:   2019-07-26 11:50:01 +0800
categories: 程序员基本功
tag: C & C++
---


* content
{:toc}


****

> **未经许可，严禁任何形式的转载！**


****

假设要为一个 `n * m` 的二维数组分配动态内存，不要这样一次性分配为数组内存空间：

```c
int **arr = (int**)malloc(n * m * sizeof(int));
```

正确的做法是：

> **先分配行，再分配列；释放内存的时候，要先释放列，再释放行**。

注意，顺序反了的话，会把列的地址擦除，导致释放列时内存时找不到地址，程序崩溃。

正确的分配空间代码如下：

```c
 int **arr = (int **)malloc(n*sizeof(int *));

 for(i=0;i<n;i++)
     arr[i] = (int *)malloc(m*sizeof(int));
```

正确的释放空间代码如下：

```c
for (i = 0; i < n; i++)
     free(arr[i]);/*释放列*/

free(arr);/*释放行*/
```

这种分配方式得到的其实并不是真正意义上的二维数组，因为其行与行之间的**内存并不连续**，虽然可以用下标 `arr[i]` 的方式访问，但当用指向该二维数组的指针来访问时候，不能通过指针值的增加来跨行获取元素，不过这种情况一般用的也不多，因此上述分配方式在大多数情况下的操作都能得到正确的结果。

